- name: ğŸ“¡ Connect to EC2 & Deploy
  uses: appleboy/ssh-action@v1.0.3
  with:
    host: ${{ secrets.SSH_HOST }}
    username: ${{ secrets.SSH_USERNAME }}
    key: ${{ secrets.SSH_PRIVATE_KEY }}
    script: |
      set -e
      cd ci-cd-practice

      echo "âš™ï¸ Cleaning untracked files to avoid merge conflicts"
      git clean -fd

      echo "ğŸ“¥ Pulling latest code"
      git pull origin main

      echo "ğŸŒ Injecting VITE_API_URL into root .env"
      echo "VITE_API_URL=${{ secrets.VITE_API_URL }}" > .env

      echo "ğŸ³ Stopping old containers"
      docker compose down

      echo "ğŸ›  Rebuilding and running containers"
      docker compose up --build -d

      echo "âœ… Deployment complete!"
